apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-alerts
  namespace: odoo-production
  labels:
    app: prometheus
    tier: monitoring
data:
  node-alerts.yml: |
    groups:
      - name: node_alerts
        interval: 30s
        rules:
          # High CPU Usage Alert
          - alert: HighCPUUsage
            expr: 100 - (avg by(instance) (rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
            for: 5m
            labels:
              severity: warning
              component: system
            annotations:
              summary: "High CPU usage detected on {{ $labels.instance }}"
              description: "CPU usage is above 80% (current value: {{ $value }}%)"

          - alert: CriticalCPUUsage
            expr: 100 - (avg by(instance) (rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 95
            for: 2m
            labels:
              severity: critical
              component: system
            annotations:
              summary: "CRITICAL: CPU usage on {{ $labels.instance }}"
              description: "CPU usage is above 95% (current value: {{ $value }}%)"

          # High Memory Usage Alert
          - alert: HighMemoryUsage
            expr: (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100 > 85
            for: 5m
            labels:
              severity: warning
              component: system
            annotations:
              summary: "High memory usage on {{ $labels.instance }}"
              description: "Memory usage is above 85% (current value: {{ $value }}%)"

          - alert: CriticalMemoryUsage
            expr: (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100 > 95
            for: 2m
            labels:
              severity: critical
              component: system
            annotations:
              summary: "CRITICAL: Memory usage on {{ $labels.instance }}"
              description: "Memory usage is above 95% (current value: {{ $value }}%)"

  database-alerts.yml: |
    groups:
      - name: database_alerts
        interval: 30s
        rules:
          - alert: PostgreSQLDown
            expr: pg_up == 0
            for: 1m
            labels:
              severity: critical
              component: database
            annotations:
              summary: "PostgreSQL is down"
              description: "PostgreSQL database is not responding"

          - alert: HighDatabaseConnections
            expr: (pg_stat_database_numbackends / pg_settings_max_connections) * 100 > 80
            for: 5m
            labels:
              severity: warning
              component: database
            annotations:
              summary: "High number of database connections"
              description: "Database connections are above 80% of max"

  odoo-alerts.yml: |
    groups:
      - name: odoo_alerts
        interval: 30s
        rules:
          - alert: OdooDown
            expr: up{job="odoo"} == 0
            for: 2m
            labels:
              severity: critical
              component: application
            annotations:
              summary: "Odoo application is down"
              description: "Odoo application is not responding"

          - alert: OdooHighResponseTime
            expr: http_request_duration_seconds{job="odoo"} > 5
            for: 5m
            labels:
              severity: warning
              component: application
            annotations:
              summary: "Odoo high response time"
              description: "Odoo response time is above 5 seconds"
